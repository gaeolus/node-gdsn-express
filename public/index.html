<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Backbone.js HelloWorld</title>
</head>
<body>
<h2>Backbone.js HelloWorld</h2>
<div id="app"></div>

<script src="js/json2.js"></script>
<script src="js/jquery-1.9.1.js"></script>
<script src="js/underscore-1.5.1.js"></script>
<script src="js/backbone-1.0.0.js"></script>
<script type="text/template" id="view_template">
    <label id="msg"><%= msg %></label><p/><label id="count"><%= count %></label>
</script>

<script>
(function ($) {

  console.log('Backbone HelloWorld this: ' + this)

  var TheModel = Backbone.Model.extend({
    defaults: {
      msg: 'Counter',
      count: 0
    },
    incrementCount: function () {
      console.log('TheModel:incrementCount')
      var count = this.get('count') + 1
      this.set( { count: count } )
    },
    resetCount: function () {
      console.log('TheModel:resetCount')
      this.set( { count: 0 } )
    }
  })
  
  var TheView = Backbone.View.extend({    
    el: '#app', // use existing

    template: _.template(this.$('#view_template').html()),

    events: {
      'click #msg': 'userReset',
      'click': 'userClicked'
    },

    initialize: function () {
      console.log('TheView:initialize');
      this.model = new TheModel()
      this.listenTo(this.model, 'change:count', this.render)
      //this.listenTo(this.model, 'all', this.render)
      this.$el.hide()
      this.render()
      this.$el.fadeIn()
    },

    render: function () {
      console.log('TheView:render')
      this.$el.html(this.template(this.model.toJSON()))
      return this // for chainable calls, like .render().el
    },

    userReset: function (event) {
      console.log('TheView:userReset:event: ');
      console.log(event)
      this.model.resetCount()
      return false
    },

    userClicked: function (event) {
      console.log('TheView:userClicked:event: ');
      console.log(event)
      this.model.incrementCount()
    }

  })

  this.view = new TheView()

})(jQuery)
</script>
</body>
</html>
